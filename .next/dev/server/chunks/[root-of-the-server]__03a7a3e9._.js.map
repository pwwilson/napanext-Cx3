{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/napanext-Cx3/pages/api/entries.js"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\n\nconst DATA = path.resolve(process.cwd(), 'data', 'entries.json')\n\nasync function read(){\n  try{\n    const raw = await fs.promises.readFile(DATA, 'utf8')\n    return JSON.parse(raw || '[]')\n  }catch(e){ return [] }\n}\n\nasync function write(list){\n  await fs.promises.mkdir(path.dirname(DATA), { recursive: true })\n  await fs.promises.writeFile(DATA, JSON.stringify(list, null, 2), 'utf8')\n}\n\nexport default async function handler(req, res){\n  if(req.method === 'GET'){\n    const list = await read()\n    // newest first\n    list.sort((a,b)=> new Date(b.created_at) - new Date(a.created_at))\n    return res.status(200).json(list)\n  }\n\n  if(req.method === 'POST'){\n    try{\n      const { type, targetName, message } = req.body\n      if(!type || !message) return res.status(400).json({ error: 'type and message required' })\n\n      const allowed = ['compliments','confessions','captions']\n      if(!allowed.includes(type)) return res.status(400).json({ error: 'invalid type' })\n\n      const list = await read()\n      const entry = {\n        id: (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : Date.now().toString(),\n        type,\n        targetName: targetName || null,\n        message: String(message).slice(0,1000),\n        created_at: new Date().toISOString()\n      }\n      list.unshift(entry)\n      await write(list)\n      return res.status(201).json(entry)\n    }catch(e){\n      console.error(e)\n      return res.status(500).json({ error: 'server error' })\n    }\n  }\n\n  res.setHeader('Allow', 'GET,POST')\n  res.status(405).end('Method Not Allowed')\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,OAAO,4GAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAEjD,eAAe;IACb,IAAG;QACD,MAAM,MAAM,MAAM,wGAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM;QAC7C,OAAO,KAAK,KAAK,CAAC,OAAO;IAC3B,EAAC,OAAM,GAAE;QAAE,OAAO,EAAE;IAAC;AACvB;AAEA,eAAe,MAAM,IAAI;IACvB,MAAM,wGAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,4GAAI,CAAC,OAAO,CAAC,OAAO;QAAE,WAAW;IAAK;IAC9D,MAAM,wGAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;AACnE;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAG,IAAI,MAAM,KAAK,OAAM;QACtB,MAAM,OAAO,MAAM;QACnB,eAAe;QACf,KAAK,IAAI,CAAC,CAAC,GAAE,IAAK,IAAI,KAAK,EAAE,UAAU,IAAI,IAAI,KAAK,EAAE,UAAU;QAChE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAC9B;IAEA,IAAG,IAAI,MAAM,KAAK,QAAO;QACvB,IAAG;YACD,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,OAAO,EAAE,GAAG,IAAI,IAAI;YAC9C,IAAG,CAAC,QAAQ,CAAC,SAAS,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA4B;YAEvF,MAAM,UAAU;gBAAC;gBAAc;gBAAc;aAAW;YACxD,IAAG,CAAC,QAAQ,QAAQ,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAe;YAEhF,MAAM,OAAO,MAAM;YACnB,MAAM,QAAQ;gBACZ,IAAI,AAAC,OAAO,WAAW,eAAe,OAAO,UAAU,GAAI,OAAO,UAAU,KAAK,KAAK,GAAG,GAAG,QAAQ;gBACpG;gBACA,YAAY,cAAc;gBAC1B,SAAS,OAAO,SAAS,KAAK,CAAC,GAAE;gBACjC,YAAY,IAAI,OAAO,WAAW;YACpC;YACA,KAAK,OAAO,CAAC;YACb,MAAM,MAAM;YACZ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAC9B,EAAC,OAAM,GAAE;YACP,QAAQ,KAAK,CAAC;YACd,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAe;QACtD;IACF;IAEA,IAAI,SAAS,CAAC,SAAS;IACvB,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC;AACtB"}}]
}